<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ—¥ä»˜è¨ˆç®—ï¼ˆæ—¥ä»˜ï¼‹æ—¥æ•°ï¼‰</title>
  <style>
    :root {
      --bg: #f7fbff;
      --card: rgba(255, 255, 255, 0.75);
      --text: rgba(16, 24, 40, 0.92);
      --muted: rgba(16, 24, 40, 0.68);
      --line: rgba(16, 24, 40, 0.10);
      /* â˜…borderç›¸å½“ */

      --accent1: #5eead4;
      /* mint */
      --accent2: #93c5fd;
      /* sky */
      --accent3: #fbcfe8;
      /* pink */

      --danger: #f87171;
      /* â˜…ãƒªã‚»ãƒƒãƒˆç”¨ï¼ˆæ˜ã‚‹ã‚èµ¤ï¼‰ */
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
        "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP",
        "Yu Gothic", "Meiryo", sans-serif;

      color: var(--text);

      background: #f4cdcd;

      min-height: 100vh;
      line-height: 1.6;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px 16px 60px;
    }

    header {
      margin: 10px 0 18px;
    }

    h1 {
      font-size: clamp(22px, 3.3vw, 32px);
      margin: 0 0 6px;
      letter-spacing: .02em;
    }

    .sub {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    @media (max-width: 840px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      border: 0px solid #000;
      background: #F0F4F8;
      border-radius: 18px;
      padding: 18px 18px 16px;
      backdrop-filter: blur(12px);

      box-shadow:
        0 10px 25px rgba(16, 24, 40, 0.06),
        0 1px 0 rgba(255, 255, 255, 0.60) inset;
    }

    .row {
      display: grid;
      gap: 10px;
      margin: 10px 0 14px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input[type="date"],
    input[type="number"] {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }

    input[type="date"]:focus,
    input[type="number"]:focus {
      border-color: rgba(2, 132, 199, 0.45);
      box-shadow: 0 0 0 4px rgba(147, 197, 253, 0.22);
    }

    .days-wrapper {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    .days-wrapper input {
      flex: 1;
    }

    .sign-btn {
      min-width: 48px;
      border-radius: 12px;
      font-weight: 700;
      background: linear-gradient(135deg,
          rgba(94, 234, 212, 0.4),
          rgba(147, 197, 253, 0.4));
    }

    .inline {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .12);
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .05s ease, box-shadow .15s ease, background .15s ease;
      user-select: none;

      box-shadow: 0 8px 16px rgba(16, 24, 40, 0.06);
    }

    button:hover:not(.sign-btn) {
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 12px 22px rgba(16, 24, 40, 0.08);
    }

    button:active {
      transform: translateY(1px);
    }

    .primary {
      border-color: rgba(125, 211, 252, .55);
      background: rgba(125, 211, 252, .14);
    }

    .danger {
      border-color: rgba(253, 164, 175, .55);
      background: rgba(253, 164, 175, .10);
    }

    .result {
      display: grid;
      gap: 10px;
    }

    .pill {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      padding: 5px 30px;
      border-radius: 999px;
      color: var(--muted);
    }

    .big {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .02em;
      overflow-wrap: anywhere;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      margin: 0;
    }

    .ok {
      color: var(--accent2);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .err {
      color: var(--danger);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .footerNote {
      margin-top: 14px;
      font-size: 12px;
      color: var(--muted);
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .15);
      color: var(--text);
    }

    /* æ›œæ—¥ã”ã¨ã®è‰² */
    .saturday {
      color: #60a5fa;
      /* é’ */
    }

    .sunday {
      color: #f87171;
      /* èµ¤ */
    }

    /* è¨ˆç®—çµæœã®æ ã ã‘å³å¯„ã› */
    #resultPill {
      margin-left: auto;
    }

    /* â˜…ãƒªã‚»ãƒƒãƒˆå°‚ç”¨ï¼šæ§ãˆã‚ãƒœã‚¿ãƒ³ */
    .reset-btn {
      padding: 6px 12px;
      /* å°ã•ã */
      font-size: 13px;
      /* å°‘ã—å°ã•ã‚ */
      opacity: 0.7;
      /* å°‘ã—è–„ã */
      background: transparent;
      /* ç›®ç«‹ãŸã›ãªã„ */
    }

    .reset-btn:hover {
      opacity: 1;
      /* ãƒ›ãƒãƒ¼æ™‚ã¯æ™®é€šã« */
      background: rgba(253, 164, 175, 0.08);
    }

    /* â˜…è¿½åŠ ï¼šãƒªã‚»ãƒƒãƒˆã ã‘æ§ãˆã‚ */
    button.danger {
      background: rgba(248, 113, 113, 0.10);
      border-color: rgba(248, 113, 113, 0.25);
    }

    button.danger:hover {
      background: rgba(248, 113, 113, 0.14);
    }

    .sign-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* â˜…ã‚¹ãƒãƒ›ã§åŸºæº–æ—¥(date)ãŒå³ã« ã¯ã¿å‡ºã‚‹å¯¾ç­– */
    #baseDate {
      min-width: 0;
      /* flex/gridå†…ã§ã®ã¯ã¿å‡ºã—é˜²æ­¢ */
      max-width: 100%;
      -webkit-appearance: none;
      /* iOSã®ç‹¬è‡ªUIã§ã®å¹…æš´ã‚Œã‚’æŠ‘ãˆã‚‹ */
      appearance: none;
    }

    /* iOS Safariå‘ã‘ï¼šæ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å†…éƒ¨ã®éƒ¨å“ãŒæŠ¼ã—åºƒã’ã‚‹ã®ã‚’æŠ‘ãˆã‚‹ */
    #baseDate::-webkit-date-and-time-value {
      width: 100%;
    }

    /* ï¼ˆä¿é™ºï¼‰æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå‡ºã‚‹ã®ã‚’é˜²ã */
    body {
      overflow-x: hidden;
    }

    /* â˜…ã‚¹ãƒãƒ›ã¯å°‘ã—ã ã‘å†…å´ã«ï¼ˆæŒ‡ã§æŠ¼ã—ã‚„ã™ã„ï¼‰ */
    @media (max-width: 480px) {
      .reset-top {
        top: 10px;
        right: 10px;
      }
    }

    /* â˜…åŸºæº–æ—¥ã®ãƒ©ãƒ™ãƒ«è¡Œã‚’å·¦å³ã«é…ç½® */
    .row-head {
      display: flex;
      align-items: center;
      /* â†é«˜ã•ãŒæƒã† */
      justify-content: space-between;
      gap: 12px;
    }

    /* â˜…å³å´ã®ãƒªã‚»ãƒƒãƒˆã¯å°ã•ã‚ã®ã¾ã¾ã€è¡Œã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹ */
    .reset-inline {
      padding: 6px 12px;
      /* reset-btnã®ã¾ã¾ã§OKãªã‚‰çœç•¥å¯ */
      line-height: 1;
      /* â†ç¸¦ã‚ºãƒ¬å¯¾ç­– */
      height: 28px;
      /* â†labelè¡Œã¨æƒãˆã‚„ã™ã„ */
    }

    /* â˜…ã‚¹ãƒãƒ›ã§æŠ¼ã—ã‚„ã™ã„ã‚ˆã†å°‘ã—ã ã‘å¤§ããã—ãŸã„å ´åˆï¼ˆä»»æ„ï¼‰ */
    @media (max-width: 480px) {
      .reset-inline {
        height: 32px;
      }
    }

    /* â˜…è¿½åŠ ï¼šï¼‹/âˆ’ãƒœã‚¿ãƒ³ï¼ˆæ•°å€¤å…¥åŠ›ã®å³å´ï¼‰ */
    .step-btn {
      min-width: 44px;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      line-height: 1;
    }

    /* â˜…å¤‰æ›´ï¼šä¸‹æ®µï¼ˆPCã¯å·¦å¯„ã› / ã‚¹ãƒãƒ›ã¯å‡ç­‰2åˆ†å‰²ï¼‰ */
    .below-row {
      display: flex;
      gap: 10px;
      align-items: stretch;
      justify-content: flex-start;
      /* â†PCã¯å·¦æƒãˆ */
    }

    /* â˜…è¿½åŠ ï¼šä¸‹æ®µã®2ã¤ã‚’åŒã˜æ¨ªå¹…ã«ã™ã‚‹ */
    .below-row>* {
      flex: 1;
      /* â†åŒã˜å¹… */
      min-width: 0;
    }

    /* â˜…è¿½åŠ ï¼šã‚¹ãƒãƒ›ã§ã¯å·¦å³ã«å‡ç­‰é…ç½®ï¼ˆåŒã˜å¹…ã®ã¾ã¾ï¼‰ */
    @media (max-width: 480px) {
      .below-row {
        justify-content: space-between;
      }
    }

    /* â˜…è¿½åŠ ï¼šlabelï¼ˆåˆæ—¥ã‚’æ•°ãˆã‚‹ï¼‰ã‚’æ¨ªå¹…ã„ã£ã±ã„ã« */
    .below-row label.inline {
      width: 100%;
      justify-content: flex-start;
      /* ãƒ†ã‚­ã‚¹ãƒˆã‚‚å·¦å¯„ã› */
    }

    /* â˜…è¿½åŠ ï¼šåˆæ—¥ã‚’æ•°ãˆã‚‹ã‚’å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ï¼ˆè¦‹ãŸç›®èª¿æ•´ï¼‰ */
    .inline-compact {
      padding: 8px 10px;
    }

    /* =========================
   â˜…è¿½åŠ ï¼šç¸¦ã®ä½™ç™½ãƒãƒ©ãƒ³ã‚¹èª¿æ•´
   ========================= */

    /* å…¨ä½“ã®è¡Œé–“ã‚’ã»ã‚“ã®å°‘ã—è©°ã‚ã‚‹ï¼ˆè¦‹ãŸç›®ãŒå®‰å®šï¼‰ */
    body {
      line-height: 1.55;
    }

    /* ã‚¿ã‚¤ãƒˆãƒ«å‘¨ã‚Šã®ä½™ç™½ã‚’æ•´ãˆã‚‹ */
    header {
      margin: 14px 0 22px;
    }

    h1 {
      margin: 0 0 10px;
    }

    .sub {
      margin: 0;
    }

    /* ã‚«ãƒ¼ãƒ‰å†…ã®ä¸Šä¸‹ã®ä½™ç™½ã‚’å°‘ã—å¢—ã‚„ã—ã¦â€œå‘¼å¸â€ã‚’ä½œã‚‹ */
    .card {
      padding: 22px 20px 20px;
    }

    /* å…¥åŠ›ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆrowï¼‰åŒå£«ã®é–“éš”ã‚’çµ±ä¸€ */
    .row {
      gap: 12px;
      /* labelâ†’inputé–“ãªã© */
      margin: 0 0 18px;
      /* rowåŒå£«ã®é–“ */
    }

    /* æœ€å¾Œã®rowã ã‘ä½™è¨ˆãªä¸‹ä½™ç™½ã‚’æ¶ˆã™ï¼ˆã‚«ãƒ¼ãƒ‰ä¸‹ãŒã ã¶ã¤ã‹ãªã„ï¼‰ */
    .row:last-of-type {
      margin-bottom: 10px;
    }

    /* labelã¨å…¥åŠ›ã®è·é›¢ã‚’æ°—æŒã¡åºƒã’ã‚‹ */
    label {
      margin-top: 2px;
    }

    /* å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’æƒãˆã¦è¦‹ãŸç›®ã‚’å®‰å®šã•ã›ã‚‹ */
    input[type="date"],
    input[type="number"],
    button {
      min-height: 44px;
      /* iPhoneã®æ¨å¥¨ã‚¿ãƒƒãƒ—ã‚µã‚¤ã‚ºã«ã‚‚è¿‘ã„ */
    }

    /* æ•°å€¤å…¥åŠ›è¡Œï¼ˆå…¥åŠ› + ï¼‹ âˆ’ï¼‰ã®ä¸Šä¸‹ã‚’å°‘ã—æ•´ãˆã‚‹ */
    .days-wrapper {
      gap: 10px;
    }

    /* æ­£è² åˆ‡æ›¿ + åˆæ—¥ã‚’æ•°ãˆã‚‹ ã®â€œæ®µâ€ã®ä¸Šã«å°‘ã—ä½™ç™½ã‚’ä½œã‚‹ */
    .below-row {
      margin-top: 10px;
      gap: 10px;
    }

    /* checkboxã®ç¸¦ä½ç½®ã‚ºãƒ¬ã‚’æŠ‘ãˆã‚‹ */
    .inline input[type="checkbox"] {
      transform: translateY(1px);
    }

    /* è¨ˆç®—çµæœã‚¨ãƒªã‚¢ã®ä½™ç™½ã‚’æ•´ãˆã‚‹ */
    .btns {
      margin-top: 16px;
      /* rowã®å¾Œã«ã¡ã‚ƒã‚“ã¨é–“ã‚’ä½œã‚‹ */
      gap: 10px;
    }

    /* pillã®ä¸­ã®ä¸Šä¸‹ä½™ç™½ã‚’å¢—ã‚„ã—ã¦è¦‹ã‚„ã™ã */
    .pill {
      padding: 12px 22px;
    }

    /* ã€Œè¨ˆç®—çµæœã€æ–‡å­—ã¨æ—¥ä»˜ã®è·é›¢ã‚’è‡ªç„¶ã« */
    .pill .muted {
      margin: 0 0 6px;
    }

    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸Šã®ä½™ç™½ã‚’çµ±ä¸€ï¼ˆinline style 12px ã‚’ä¸Šæ›¸ãï¼‰ */
    .card>div[style*="margin-top:12px"] {
      margin-top: 14px !important;
    }

    /* ã‚¨ãƒ©ãƒ¼/OKã®è¡Œé–“ã¨ä½™ç™½ã‚’æ•´ãˆã‚‹ */
    .err,
    .ok {
      min-height: 18px;
      line-height: 1.35;
    }

    /* ã‚¹ãƒãƒ›ã¯ã‚«ãƒ¼ãƒ‰å†…ä½™ç™½ã‚’å°‘ã—ã ã‘æ¸›ã‚‰ã™ï¼ˆçª®å±ˆã«è¦‹ãˆãªã„ç¨‹åº¦ï¼‰ */
    @media (max-width: 480px) {
      .card {
        padding: 18px 16px 16px;
      }

      .row {
        margin-bottom: 16px;
      }

      .pill {
        padding: 10px 30px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>æ—¥ä»˜è¨ˆç®—</h1>
      <p class="sub">åŸºæº–æ—¥ã‹ã‚‰æŒ‡å®šã—ãŸæ—¥æ•°ã‚’è¶³ã—å¼•ãã—ã¦æ—¥ä»˜ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>
    </header>

    <div class="grid">
      <!-- å…¥åŠ› -->
      <section class="card" aria-label="å…¥åŠ›">
        <div class="row">
          <!-- â˜…è¿½åŠ ï¼šãƒ©ãƒ™ãƒ«è¡Œã‚’å·¦å³ã«åˆ†ã‘ã‚‹ -->
          <div class="row-head">
            <label for="baseDate">åŸºæº–æ—¥</label>

            <!-- â˜…ã“ã“ã«ç§»å‹•ï¼šåŸºæº–æ—¥ãƒ©ãƒ™ãƒ«ã¨åŒã˜é«˜ã•ã§æƒã† -->
            <button class="danger reset-btn reset-inline" id="resetBtn" type="button">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>

          <input id="baseDate" type="date" />
        </div>

        <div class="row">
          <label for="days">æ—¥æ•°ã®å·®ï¼ˆãƒã‚¤ãƒŠã‚¹å€¤ã‚‚å…¥åŠ›å¯èƒ½ï¼‰</label>

          <!-- æ•°å€¤å…¥åŠ› + å³å´ã«ã€Œï¼‹ã€ã€Œâˆ’ã€ -->
          <div class="days-wrapper">
            <input id="days" type="number" inputmode="numeric" placeholder="" />

            <button type="button" class="step-btn" id="plusBtn">ï¼‹</button>
            <button type="button" class="step-btn" id="minusBtn">âˆ’</button>
          </div>

          <!-- æ­£è² åˆ‡æ›¿ï¼ˆå·¦ï¼‰ + åˆæ—¥ã‚’æ•°ãˆã‚‹ï¼ˆå³ï¼‰ -->
          <div class="below-row">
            <button type="button" class="sign-btn" id="toggleSignBtn">æ­£è² åˆ‡æ›¿</button>

            <label class="inline inline-compact" for="includeStart">
              <input id="includeStart" type="checkbox" />
              åˆæ—¥ã‚’æ•°ãˆã‚‹
            </label>
          </div>
        </div>

        <div class="btns">
          <!-- çµæœ -->
          <div class="pill" id="resultPill" style="margin-top:0;">
            <p class="muted">è¨ˆç®—çµæœ</p>
            <span class="big" id="resultDate">----/--/--ï¼ˆ-ï¼‰</span>
            <div class="muted" id="holidayText"></div> <!-- â˜…ã“ã“ã‚’è¿½åŠ  -->
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="err" id="errorText"></div>
          <div class="ok" id="okText"></div>
        </div>

      </section>
    </div>
  </div>

  <script>
    // =========================
    // ã“ã“ã‹ã‚‰JSï¼ˆè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    // =========================

    const baseDateEl = document.getElementById('baseDate');
    const daysEl = document.getElementById('days');
    const includeStartEl = document.getElementById('includeStart');

    const resultDateEl = document.getElementById('resultDate');

    // â˜…è¿½åŠ ï¼šç¥æ—¥è¡¨ç¤ºç”¨
    const holidayTextEl = document.getElementById('holidayText');

    // â˜…è¿½åŠ ï¼šGoogleç¥æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆæ—¥æœ¬ï¼‰ã‹ã‚‰ç¥æ—¥åã‚’å–å¾—
    async function getJapaneseHolidayName(ymd) {
      // Google Public Holidays (Japan) ã® iCal ã‚’JSONã§èª­ã‚€ï¼ˆrss2jsonçµŒç”±ï¼‰
      // â€»URLã¯ã‚³ãƒ¼ãƒ‰å†…ãªã®ã§ãã®ã¾ã¾ä½¿ãˆã¾ã™
      const icalUrl = 'https://calendar.google.com/calendar/ical/ja.japanese%23holiday%40group.v.calendar.google.com/public/basic.ics';

      // rss2jsonã¯ã€ŒURLã‚’JSONåŒ–ã—ã¦è¿”ã™ã€ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆç„¡æ–™æ ã‚ã‚Šï¼‰
      const api = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(icalUrl)}`;

      const res = await fetch(api);
      if (!res.ok) throw new Error('ç¥æ—¥ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
      const data = await res.json();

      // itemsã®ä¸­ã« "YYYYMMDD" ã‚’å«ã‚€è¡ŒãŒã‚ã‚‹ã®ã§ã€ã–ã£ãã‚Šæ¢ã™
      // ç¥æ—¥ã®ICSã¯ DTSTART;VALUE=DATE:20260101 ã®ã‚ˆã†ãªå½¢å¼
      const key = ymd.replace(/-/g, ''); // YYYYMMDD

      for (const item of (data.items ?? [])) {
        const content = item.content || '';
        if (content.includes(`DTSTART;VALUE=DATE:${key}`)) {
          // ç¥æ—¥åã¯SUMMARY:â—‹â—‹ ã®ã‚ˆã†ã«å…¥ã£ã¦ã‚‹
          const m = content.match(/SUMMARY:(.+)/);
          if (m && m[1]) return m[1].trim();
          return 'ç¥æ—¥';
        }
      }
      return null;
    }

    const errorTextEl = document.getElementById('errorText');
    const okTextEl = document.getElementById('okText');

    const calcBtn = document.getElementById('calcBtn');
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    const resetBtn = document.getElementById('resetBtn');

    const toggleSignBtn = document.getElementById('toggleSignBtn');

    const plusBtn = document.getElementById('plusBtn');
    const minusBtn = document.getElementById('minusBtn');

    // â˜…è¿½åŠ ï¼šï¼‹/âˆ’ã§1ãšã¤å¢—æ¸›
    function stepDays(delta) {
      const v = String(daysEl.value ?? '').trim();

      // ç©ºã‚„å…¥åŠ›é€”ä¸­ãªã‚‰ã€Œ0ã€ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
      let n = 0;
      if (v !== '' && v !== '-' && v !== '+') {
        n = Number(v);
        if (Number.isNaN(n)) n = 0;
      }

      daysEl.value = String(n + delta);

      updateSignButtonState();
      calculate();
    }

    plusBtn.addEventListener('click', () => stepDays(1));
    minusBtn.addEventListener('click', () => stepDays(-1));

    function updateSignButtonState() {
      const value = daysEl.value.trim();

      if (value === '' || Number(value) === 0) {
        toggleSignBtn.disabled = true;
      } else {
        toggleSignBtn.disabled = false;
      }
    }

    toggleSignBtn.addEventListener('click', () => {
      const value = daysEl.value.trim();

      if (value === '' || Number(value) === 0) return;

      if (value.startsWith('-')) {
        daysEl.value = value.substring(1);
      } else {
        daysEl.value = '-' + value;
      }

      updateSignButtonState();
      calculate();
    });

    const WEEK = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

    // âœ… ä»Šæ—¥ã‚’ date input ã«å…¥ã‚Œã‚‹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ—¥ä»˜ï¼‰
    function setToday() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      baseDateEl.value = `${yyyy}-${mm}-${dd}`;
    }

    // âœ… "YYYY-MM-DD" ã‚’ã€Œãã®æ—¥ã®æ­£åˆ(12:00)ã€ã¨ã—ã¦Dateã«ã™ã‚‹
    // ï¼ˆæ·±å¤œ0æ™‚ã ã¨ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚„å¤æ™‚é–“ã§ã‚ºãƒ¬ã‚‹äº‹æ•…ãŒãŸã¾ã«ã‚ã‚‹ã®ã§å®‰å…¨ç­–ï¼‰
    function parseYMDToLocalNoon(ymd) {
      const [y, m, d] = ymd.split('-').map(Number);
      return new Date(y, m - 1, d, 12, 0, 0, 0);
    }

    function formatJP(dateObj) {
      const y = dateObj.getFullYear();
      const m = dateObj.getMonth() + 1;
      const d = dateObj.getDate();
      const dayIndex = dateObj.getDay();
      const w = WEEK[dayIndex];

      // â˜…æ›œæ—¥ã ã‘ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹
      let dayClass = '';
      if (dayIndex === 0) dayClass = 'sunday';
      if (dayIndex === 6) dayClass = 'saturday';

      return `${y}/${String(m).padStart(2, '0')}/${String(d).padStart(2, '0')}ï¼ˆ<span class="${dayClass}">${w}</span>ï¼‰`;
    }

    function formatISO(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, '0');
      const d = String(dateObj.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function clearMessages() {
      errorTextEl.textContent = '';
      okTextEl.textContent = '';
    }

    function showError(msg) {
      errorTextEl.textContent = msg;
      okTextEl.textContent = '';
    }

    // âœ… è¨ˆç®—
    function calculate() {
      clearMessages();

      const baseYMD = baseDateEl.value;
      if (!baseYMD) {
        showError('åŸºæº–æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      const daysStr = String(daysEl.value ?? '').trim();

      // â˜…å¤‰æ›´ï¼šç©ºãªã‚‰ã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ã§ã€çµæœã‚’ã€Œâ€”ã€ã«æˆ»ã—ã¦çµ‚ã‚ã‚Š
      if (daysStr === '') {
        resultDateEl.textContent = '----/--/--ï¼ˆ-ï¼‰';
        updateSignButtonState();
        return;
      }

      // â˜…å…¥åŠ›é€”ä¸­ã®ã€Œ-ã€ã ã‘ç­‰ã‚‚è¨ˆç®—ã—ãªã„ï¼ˆã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ï¼‰
      if (daysStr === '-' || daysStr === '+') {
        resultDateEl.textContent = '----/--/--ï¼ˆ-ï¼‰';
        updateSignButtonState();
        return;
      }

      if (Number.isNaN(Number(daysStr))) {
        showError('æ—¥æ•°ã‚’æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        resultDateEl.textContent = '----/--/--ï¼ˆ-ï¼‰';
        return;
      }

      const days = Number(daysStr);

      // åˆæ—¥ã‚’æ•°ãˆã‚‹ãªã‚‰ã€å®Ÿè³ªã€Œdays-1ã€ã‚’è¶³ã™
      let addDays;

      if (includeStartEl.checked) {
        // â˜…åˆæ—¥ã‚’æ•°ãˆã‚‹ãƒ¢ãƒ¼ãƒ‰
        if (days === 1 || days === -1) {
          addDays = 0; // â˜…Â±1ã¯å½“æ—¥
        } else if (days > 1) {
          addDays = days - 1;
        } else if (days < -1) {
          addDays = days + 1;
        } else {
          addDays = 0; // days === 0 ã®å ´åˆ
        }
      } else {
        addDays = days;
      }

      const base = parseYMDToLocalNoon(baseYMD);
      const result = new Date(base);
      result.setDate(result.getDate() + addDays);

      // æ›œæ—¥ã”ã¨ã«è‰²ã‚’å¤‰æ›´
      resultDateEl.innerHTML = formatJP(result);

      // â˜…è¿½åŠ ï¼šç¥æ—¥åˆ¤å®šï¼ˆéåŒæœŸï¼‰
      (async () => {
        try {
          const ymd = formatISO(result); // "YYYY-MM-DD"
          const name = await getJapaneseHolidayName(ymd);
          holidayTextEl.textContent = name ? `ğŸŒ ç¥æ—¥ï¼š${name}` : 'ç¥æ—¥ã§ã¯ã‚ã‚Šã¾ã›ã‚“';
        } catch (e) {
          holidayTextEl.textContent = 'ç¥æ—¥åˆ¤å®šï¼šå–å¾—ã§ãã¾ã›ã‚“ï¼ˆé€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼‰';
        }
      })();

      const baseJP = formatJP(base);
      const modeText = includeStartEl.checked ? 'åˆæ—¥ã‚’æ•°ãˆã‚‹' : 'åˆæ—¥ã‚’æ•°ãˆãªã„';
    }

    // ãƒªã‚»ãƒƒãƒˆ
    function resetAll() {
      // â˜…åˆæœŸçŠ¶æ…‹ã«æˆ»ã™ï¼šä»Šæ—¥ + 0
      includeStartEl.checked = false;
      setToday();       // â˜…ä»Šæ—¥ã‚’å…¥ã‚Œã‚‹
      daysEl.value = ''; // â˜…æ—¥æ•°ã‚’0ã«æˆ»ã™
      clearMessages();
      calculate();      // â˜…è¡¨ç¤ºã‚‚æ›´æ–°
      updateSignButtonState();
    }

    // ãƒœã‚¿ãƒ³æ“ä½œï¼ˆâ˜…calcBtn ã¯å­˜åœ¨ã—ãªã„ã®ã§ if ã§å®‰å…¨ã«ï¼‰
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    resetBtn.addEventListener('click', resetAll);

    // å…¥åŠ›ã—ãŸã‚‰è‡ªå‹•ã§å†è¨ˆç®—ï¼ˆæ“ä½œãŒãƒ©ã‚¯ï¼‰
    baseDateEl.addEventListener('change', calculate);
    daysEl.addEventListener('input', () => {
      // â˜…è¿½åŠ ï¼šæ—¥æ•°ã¯æœ€å¤§4æ¡ï¼ˆ-ã‚‚OKï¼‰ã«åˆ¶é™ã™ã‚‹
      const MAX_DIGITS = 4;

      let raw = String(daysEl.value ?? '');

      // å…ˆé ­ã® - ã¯æ®‹ã—ã¦ã€æ•°å­—ã ã‘å–ã‚Šå‡ºã™
      const sign = raw.startsWith('-') ? '-' : '';
      let digits = raw.replace(/[^0-9]/g, ''); // æ•°å­—ä»¥å¤–ã¯æ¶ˆã™

      // å…ˆé ­ã®0ãŒé€£ç¶šã™ã‚‹ã®ã‚’æŠ‘ãˆã‚‹ï¼ˆä»»æ„ï¼‰
      digits = digits.replace(/^0+(?=\d)/, '');

      // æ¡æ•°ã‚«ãƒƒãƒˆ
      if (digits.length > MAX_DIGITS) {
        digits = digits.slice(0, MAX_DIGITS);
      }

      // åæ˜ 
      daysEl.value = sign + digits;

      updateSignButtonState();

      const v = String(daysEl.value).trim();

      // â˜…è¿½åŠ ï¼šç©º or å…¥åŠ›é€”ä¸­ãªã‚‰ã€Œçµæœã‚’ãƒªã‚»ãƒƒãƒˆè¡¨ç¤ºã€ã«æˆ»ã™
      if (v === '' || v === '-' || v === '+') {
        clearMessages(); // ã‚¨ãƒ©ãƒ¼æ–‡ã‚‚æ¶ˆã™ï¼ˆä»»æ„ã ã‘ã©è¦‹ãŸç›®ãŒç¶ºéº—ï¼‰
        resultDateEl.textContent = '----/--/--ï¼ˆ-ï¼‰';
        return;
      }

      calculate();
    });
    includeStartEl.addEventListener('change', calculate);

    // åˆæœŸçŠ¶æ…‹ï¼šä»Šæ—¥ã‚’å…¥ã‚Œã¦ãŠãï¼ˆå¥½ã¿ã§æ¶ˆã—ã¦OKï¼‰
    setToday();
    daysEl.value = '';          // â˜…åˆæœŸã¯ç©º
    resultDateEl.textContent = '----/--/--ï¼ˆ-ï¼‰';
    updateSignButtonState();
    calculate(); // â†ã“ã®ã¾ã¾ã§OKï¼ˆç©ºãªã‚‰â€”ã§çµ‚ã‚ã‚‹ï¼‰
  </script>
</body>

</html>
