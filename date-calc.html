<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>日付計算（日付＋日数）</title>
  <style>
    :root {
      --bg: #f7fbff;
      --card: rgba(255, 255, 255, 0.75);
      --text: rgba(16, 24, 40, 0.92);
      --muted: rgba(16, 24, 40, 0.68);
      --line: rgba(16, 24, 40, 0.10);
      /* ★border相当 */

      --accent1: #5eead4;
      /* mint */
      --accent2: #93c5fd;
      /* sky */
      --accent3: #fbcfe8;
      /* pink */

      --danger: #f87171;
      /* ★リセット用（明るめ赤） */
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
        "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP",
        "Yu Gothic", "Meiryo", sans-serif;

      color: var(--text);

      background:
        radial-gradient(900px 520px at 10% 0%, rgba(94, 234, 212, 0.30), transparent 60%),
        radial-gradient(900px 520px at 90% 10%, rgba(147, 197, 253, 0.28), transparent 55%),
        radial-gradient(900px 520px at 60% 90%, rgba(251, 207, 232, 0.25), transparent 55%),
        linear-gradient(180deg, #ffffff 0%, var(--bg) 100%);

      min-height: 100vh;
      line-height: 1.6;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px 16px 60px;
    }

    header {
      margin: 10px 0 18px;
    }

    h1 {
      font-size: clamp(22px, 3.3vw, 32px);
      margin: 0 0 6px;
      letter-spacing: .02em;
    }

    .sub {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    @media (max-width: 840px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      border: 1px solid var(--line);
      background: var(--card);
      border-radius: 18px;
      padding: 18px 18px 16px;
      backdrop-filter: blur(12px);

      box-shadow:
        0 10px 25px rgba(16, 24, 40, 0.06),
        0 1px 0 rgba(255, 255, 255, 0.60) inset;
    }

    .row {
      display: grid;
      gap: 10px;
      margin: 10px 0 14px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input[type="date"],
    input[type="number"] {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }

    input[type="date"]:focus,
    input[type="number"]:focus {
      border-color: rgba(2, 132, 199, 0.45);
      box-shadow: 0 0 0 4px rgba(147, 197, 253, 0.22);
    }

    .inline {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .12);
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .05s ease, box-shadow .15s ease, background .15s ease;
      user-select: none;

      box-shadow: 0 8px 16px rgba(16, 24, 40, 0.06);
    }

    button:hover {
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 12px 22px rgba(16, 24, 40, 0.08);
    }

    button:active {
      transform: translateY(1px);
    }

    .primary {
      border-color: rgba(125, 211, 252, .55);
      background: rgba(125, 211, 252, .14);
    }

    .danger {
      border-color: rgba(253, 164, 175, .55);
      background: rgba(253, 164, 175, .10);
    }

    .result {
      display: grid;
      gap: 10px;
    }

    .pill {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      padding: 5px 30px;
      border-radius: 999px;
      color: var(--muted);
    }

    .big {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .02em;
      overflow-wrap: anywhere;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      margin: 0;
    }

    .ok {
      color: var(--accent2);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .err {
      color: var(--danger);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .footerNote {
      margin-top: 14px;
      font-size: 12px;
      color: var(--muted);
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .15);
      color: var(--text);
    }

    /* 曜日ごとの色 */
    .saturday {
      color: #60a5fa;
      /* 青 */
    }

    .sunday {
      color: #f87171;
      /* 赤 */
    }

    /* 計算結果の枠だけ右寄せ */
    #resultPill {
      margin-left: auto;
    }

    /* ★リセット専用：控えめボタン */
    .reset-btn {
      padding: 6px 12px;
      /* 小さく */
      font-size: 13px;
      /* 少し小さめ */
      opacity: 0.7;
      /* 少し薄く */
      background: transparent;
      /* 目立たせない */
    }

    .reset-btn:hover {
      opacity: 1;
      /* ホバー時は普通に */
      background: rgba(253, 164, 175, 0.08);
    }

    /* ★追加：リセットだけ控えめ */
    button.danger {
      background: rgba(248, 113, 113, 0.10);
      border-color: rgba(248, 113, 113, 0.25);
    }

    button.danger:hover {
      background: rgba(248, 113, 113, 0.14);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>日付計算（日付＋日数）</h1>
      <p class="sub">日付に日数を足して、新しい日付と曜日を出します（負数で引き算も可能）。</p>
    </header>

    <div class="grid">
      <!-- 入力 -->
      <section class="card" aria-label="入力">
        <div class="row">
          <label for="baseDate">基準日</label>
          <input id="baseDate" type="date" />
        </div>

        <div class="row">
          <label for="days">＋日数（マイナス値も入力可能）</label>
          <input id="days" type="number" inputmode="numeric" placeholder="例：30 / -7" />
        </div>

        <div class="row">
            <label class="inline" for="includeStart">
              <input id="includeStart" type="checkbox" />
              初日を数える（今日を1日目として計算）
            </label>
        </div>

        <div class="btns">
          <button class="danger reset-btn" id="resetBtn" type="button">リセット</button>

          <!-- 結果 -->
          <div class="pill" id="resultPill" style="margin-top:0;">
            <p class="muted">計算結果</p>
            <span class="big" id="resultDate">—</span>
          </div>

        </div>

        <div style="margin-top:12px">
          <div class="err" id="errorText"></div>
          <div class="ok" id="okText"></div>
        </div>

      </section>
    </div>
  </div>

  <script>
    // =========================
    // ここからJS（計算ロジック）
    // =========================

    const baseDateEl = document.getElementById('baseDate');
    const daysEl = document.getElementById('days');
    const includeStartEl = document.getElementById('includeStart');

    const resultDateEl = document.getElementById('resultDate');

    const errorTextEl = document.getElementById('errorText');
    const okTextEl = document.getElementById('okText');

    const calcBtn = document.getElementById('calcBtn');
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    const resetBtn = document.getElementById('resetBtn');

    const WEEK = ['日', '月', '火', '水', '木', '金', '土'];

    // ✅ 今日を date input に入れる（ローカル日付）
    function setToday() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      baseDateEl.value = `${yyyy}-${mm}-${dd}`;
    }

    // ✅ "YYYY-MM-DD" を「その日の正午(12:00)」としてDateにする
    // （深夜0時だとタイムゾーンや夏時間でズレる事故がたまにあるので安全策）
    function parseYMDToLocalNoon(ymd) {
      const [y, m, d] = ymd.split('-').map(Number);
      return new Date(y, m - 1, d, 12, 0, 0, 0);
    }

    function formatJP(dateObj) {
      const y = dateObj.getFullYear();
      const m = dateObj.getMonth() + 1;
      const d = dateObj.getDate();
      const dayIndex = dateObj.getDay();
      const w = WEEK[dayIndex];

      // ★曜日だけクラスを付ける
      let dayClass = '';
      if (dayIndex === 0) dayClass = 'sunday';
      if (dayIndex === 6) dayClass = 'saturday';

      return `${y}/${String(m).padStart(2, '0')}/${String(d).padStart(2, '0')}（<span class="${dayClass}">${w}</span>）`;
    }

    function formatISO(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, '0');
      const d = String(dateObj.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function clearMessages() {
      errorTextEl.textContent = '';
      okTextEl.textContent = '';
    }

    function showError(msg) {
      errorTextEl.textContent = msg;
      okTextEl.textContent = '';
    }

    // ✅ 計算
    function calculate() {
      clearMessages();

      const baseYMD = baseDateEl.value;
      if (!baseYMD) {
        showError('基準日を入力してください。');
        return;
      }

      const daysStr = String(daysEl.value ?? '').trim();
      if (daysStr === '' || Number.isNaN(Number(daysStr))) {
        showError('日数を数字で入力してください（例：30 / -7）。');
        return;
      }

      const days = Number(daysStr);

      // 初日を数えるなら、実質「days-1」を足す
      let addDays;

      if (includeStartEl.checked) {
        // ★初日を数えるモード
        if (days === 1 || days === -1) {
          addDays = 0; // ★±1は当日
        } else if (days > 1) {
          addDays = days - 1;
        } else if (days < -1) {
          addDays = days + 1;
        } else {
          addDays = 0; // days === 0 の場合
        }
      } else {
        addDays = days;
      }

      const base = parseYMDToLocalNoon(baseYMD);
      const result = new Date(base);
      result.setDate(result.getDate() + addDays);

      // 曜日ごとに色を変更
      resultDateEl.innerHTML = formatJP(result);

      const baseJP = formatJP(base);
      const modeText = includeStartEl.checked ? '初日を数える' : '初日を数えない';
    }

    // リセット
    function resetAll() {
      // ★初期状態に戻す：今日 + 0
      includeStartEl.checked = false;
      setToday();       // ★今日を入れる
      daysEl.value = 0; // ★日数を0に戻す
      clearMessages();
      calculate();      // ★表示も更新
    }

    // ボタン操作（★calcBtn は存在しないので if で安全に）
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    resetBtn.addEventListener('click', resetAll);

    // 入力したら自動で再計算（操作がラク）
    baseDateEl.addEventListener('change', calculate);
    daysEl.addEventListener('input', () => {
      // 入力中のエラーを減らすため、空なら計算しない
      if (String(daysEl.value).trim() !== '') calculate();
    });
    includeStartEl.addEventListener('change', calculate);

    // 初期状態：今日を入れておく（好みで消してOK）
    setToday();
    daysEl.value = 0;
    calculate();
  </script>
</body>

</html>
