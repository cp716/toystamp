<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>日付計算（日付＋日数）</title>
  <style>
    :root {
      --bg: #f7fbff;
      --card: rgba(255, 255, 255, 0.75);
      --text: rgba(16, 24, 40, 0.92);
      --muted: rgba(16, 24, 40, 0.68);
      --line: rgba(16, 24, 40, 0.10);
      /* ★border相当 */

      --accent1: #5eead4;
      /* mint */
      --accent2: #93c5fd;
      /* sky */
      --accent3: #fbcfe8;
      /* pink */

      --danger: #f87171;
      /* ★リセット用（明るめ赤） */
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
        "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP",
        "Yu Gothic", "Meiryo", sans-serif;

      color: var(--text);

      background: #f4cdcd;

      min-height: 100vh;
      line-height: 1.6;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 24px 16px 60px;
    }

    header {
      margin: 10px 0 18px;
    }

    h1 {
      font-size: clamp(22px, 3.3vw, 32px);
      margin: 0 0 6px;
      letter-spacing: .02em;
    }

    .sub {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }

    @media (max-width: 840px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      border: 0px solid #000;
      background: #F0F4F8;
      border-radius: 18px;
      padding: 18px 18px 16px;
      backdrop-filter: blur(12px);

      box-shadow:
        0 10px 25px rgba(16, 24, 40, 0.06),
        0 1px 0 rgba(255, 255, 255, 0.60) inset;
    }

    .row {
      display: grid;
      gap: 10px;
      margin: 10px 0 14px;
    }

    label {
      font-size: 13px;
      color: var(--muted);
    }

    input[type="date"],
    input[type="number"] {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }

    input[type="date"]:focus,
    input[type="number"]:focus {
      border-color: rgba(2, 132, 199, 0.45);
      box-shadow: 0 0 0 4px rgba(147, 197, 253, 0.22);
    }

    .days-wrapper {
      display: flex;
      gap: 8px;
      align-items: stretch;
    }

    .days-wrapper input {
      flex: 1;
    }

    .sign-btn {
      min-width: 48px;
      border-radius: 12px;
      font-weight: 700;
      background: linear-gradient(135deg,
          rgba(94, 234, 212, 0.4),
          rgba(147, 197, 253, 0.4));
    }

    .inline {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .12);
    }

    .btns {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 14px;
      transition: transform .05s ease, box-shadow .15s ease, background .15s ease;
      user-select: none;

      box-shadow: 0 8px 16px rgba(16, 24, 40, 0.06);
    }

    button:hover:not(.sign-btn) {
      background: rgba(255, 255, 255, 0.85);
      box-shadow: 0 12px 22px rgba(16, 24, 40, 0.08);
    }

    button:active {
      transform: translateY(1px);
    }

    .primary {
      border-color: rgba(125, 211, 252, .55);
      background: rgba(125, 211, 252, .14);
    }

    .danger {
      border-color: rgba(253, 164, 175, .55);
      background: rgba(253, 164, 175, .10);
    }

    .result {
      display: grid;
      gap: 10px;
    }

    .pill {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.70);
      padding: 5px 30px;
      border-radius: 999px;
      color: var(--muted);
    }

    .big {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .02em;
      overflow-wrap: anywhere;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
      margin: 0;
    }

    .ok {
      color: var(--accent2);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .err {
      color: var(--danger);
      font-weight: 600;
      font-size: 13px;
      min-height: 18px;
    }

    .footerNote {
      margin-top: 14px;
      font-size: 12px;
      color: var(--muted);
    }

    .kbd {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: rgba(0, 0, 0, .15);
      color: var(--text);
    }

    /* 曜日ごとの色 */
    .saturday {
      color: #60a5fa;
      /* 青 */
    }

    .sunday {
      color: #f87171;
      /* 赤 */
    }

    /* 計算結果の枠だけ右寄せ */
    #resultPill {
      margin-left: auto;
    }

    /* ★リセット専用：控えめボタン */
    .reset-btn {
      padding: 6px 12px;
      /* 小さく */
      font-size: 13px;
      /* 少し小さめ */
      opacity: 0.7;
      /* 少し薄く */
      background: transparent;
      /* 目立たせない */
    }

    .reset-btn:hover {
      opacity: 1;
      /* ホバー時は普通に */
      background: rgba(253, 164, 175, 0.08);
    }

    /* ★追加：リセットだけ控えめ */
    button.danger {
      background: rgba(248, 113, 113, 0.10);
      border-color: rgba(248, 113, 113, 0.25);
    }

    button.danger:hover {
      background: rgba(248, 113, 113, 0.14);
    }

    .sign-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* ★スマホで基準日(date)が右に はみ出る対策 */
    #baseDate {
      min-width: 0;
      /* flex/grid内でのはみ出し防止 */
      max-width: 100%;
      -webkit-appearance: none;
      /* iOSの独自UIでの幅暴れを抑える */
      appearance: none;
    }

    /* iOS Safari向け：日付フィールド内部の部品が押し広げるのを抑える */
    #baseDate::-webkit-date-and-time-value {
      width: 100%;
    }

    /* （保険）横スクロールが出るのを防ぐ */
    body {
      overflow-x: hidden;
    }

    /* ★スマホは少しだけ内側に（指で押しやすい） */
    @media (max-width: 480px) {
      .reset-top {
        top: 10px;
        right: 10px;
      }
    }

    /* ★基準日のラベル行を左右に配置 */
    .row-head {
      display: flex;
      align-items: center;
      /* ←高さが揃う */
      justify-content: space-between;
      gap: 12px;
    }

    /* ★右側のリセットは小さめのまま、行にフィットさせる */
    .reset-inline {
      padding: 6px 12px;
      /* reset-btnのままでOKなら省略可 */
      line-height: 1;
      /* ←縦ズレ対策 */
      height: 28px;
      /* ←label行と揃えやすい */
    }

    /* ★スマホで押しやすいよう少しだけ大きくしたい場合（任意） */
    @media (max-width: 480px) {
      .reset-inline {
        height: 32px;
      }
    }

    /* ★追加：＋/−ボタン（数値入力の右側） */
    .step-btn {
      min-width: 44px;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      line-height: 1;
    }

    /* ★変更：下段（PCは左寄せ / スマホは均等2分割） */
    .below-row {
      display: flex;
      gap: 10px;
      align-items: stretch;
      justify-content: flex-start;
      /* ←PCは左揃え */
    }

    /* ★追加：下段の2つを同じ横幅にする */
    .below-row>* {
      flex: 1;
      /* ←同じ幅 */
      min-width: 0;
    }

    /* ★追加：スマホでは左右に均等配置（同じ幅のまま） */
    @media (max-width: 480px) {
      .below-row {
        justify-content: space-between;
      }
    }

    /* ★追加：label（初日を数える）を横幅いっぱいに */
    .below-row label.inline {
      width: 100%;
      justify-content: flex-start;
      /* テキストも左寄せ */
    }

    /* ★追加：初日を数えるを少しコンパクトに（見た目調整） */
    .inline-compact {
      padding: 8px 10px;
    }

    /* =========================
   ★追加：縦の余白バランス調整
   ========================= */

    /* 全体の行間をほんの少し詰める（見た目が安定） */
    body {
      line-height: 1.55;
    }

    /* タイトル周りの余白を整える */
    header {
      margin: 14px 0 22px;
    }

    h1 {
      margin: 0 0 10px;
    }

    .sub {
      margin: 0;
    }

    /* カード内の上下の余白を少し増やして“呼吸”を作る */
    .card {
      padding: 22px 20px 20px;
    }

    /* 入力ブロック（row）同士の間隔を統一 */
    .row {
      gap: 12px;
      /* label→input間など */
      margin: 0 0 18px;
      /* row同士の間 */
    }

    /* 最後のrowだけ余計な下余白を消す（カード下がだぶつかない） */
    .row:last-of-type {
      margin-bottom: 10px;
    }

    /* labelと入力の距離を気持ち広げる */
    label {
      margin-top: 2px;
    }

    /* 入力欄とボタンの高さを揃えて見た目を安定させる */
    input[type="date"],
    input[type="number"],
    button {
      min-height: 44px;
      /* iPhoneの推奨タップサイズにも近い */
    }

    /* 数値入力行（入力 + ＋ −）の上下を少し整える */
    .days-wrapper {
      gap: 10px;
    }

    /* 正負切替 + 初日を数える の“段”の上に少し余白を作る */
    .below-row {
      margin-top: 10px;
      gap: 10px;
    }

    /* checkboxの縦位置ズレを抑える */
    .inline input[type="checkbox"] {
      transform: translateY(1px);
    }

    /* 計算結果エリアの余白を整える */
    .btns {
      margin-top: 16px;
      /* rowの後にちゃんと間を作る */
      gap: 10px;
    }

    /* pillの中の上下余白を増やして見やすく */
    .pill {
      padding: 12px 22px;
    }

    /* 「計算結果」文字と日付の距離を自然に */
    .pill .muted {
      margin: 0 0 6px;
    }

    /* メッセージの上の余白を統一（inline style 12px を上書き） */
    .card>div[style*="margin-top:12px"] {
      margin-top: 14px !important;
    }

    /* エラー/OKの行間と余白を整える */
    .err,
    .ok {
      min-height: 18px;
      line-height: 1.35;
    }

    /* スマホはカード内余白を少しだけ減らす（窮屈に見えない程度） */
    @media (max-width: 480px) {
      .card {
        padding: 18px 16px 16px;
      }

      .row {
        margin-bottom: 16px;
      }

      .pill {
        padding: 10px 30px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>日付計算</h1>
      <p class="sub">基準日から指定した日数を足し引きして日付を計算します。</p>
    </header>

    <div class="grid">
      <!-- 入力 -->
      <section class="card" aria-label="入力">
        <div class="row">
          <!-- ★追加：ラベル行を左右に分ける -->
          <div class="row-head">
            <label for="baseDate">基準日</label>

            <!-- ★ここに移動：基準日ラベルと同じ高さで揃う -->
            <button class="danger reset-btn reset-inline" id="resetBtn" type="button">リセット</button>
          </div>

          <input id="baseDate" type="date" />
        </div>

        <div class="row">
          <label for="days">日数の差（マイナス値も入力可能）</label>

          <!-- 数値入力 + 右側に「＋」「−」 -->
          <div class="days-wrapper">
            <input id="days" type="number" inputmode="numeric" placeholder="" />

            <button type="button" class="step-btn" id="plusBtn">＋</button>
            <button type="button" class="step-btn" id="minusBtn">−</button>
          </div>

          <!-- 正負切替（左） + 初日を数える（右） -->
          <div class="below-row">
            <button type="button" class="sign-btn" id="toggleSignBtn">正負切替</button>

            <label class="inline inline-compact" for="includeStart">
              <input id="includeStart" type="checkbox" />
              初日を数える
            </label>
          </div>
        </div>

        <div class="btns">
          <!-- 結果 -->
          <div class="pill" id="resultPill" style="margin-top:0;">
            <p class="muted">計算結果</p>
            <span class="big" id="resultDate">----/--/--（-）</span>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="err" id="errorText"></div>
          <div class="ok" id="okText"></div>
        </div>

      </section>
    </div>
  </div>

  <script>
    // =========================
    // ここからJS（計算ロジック）
    // =========================

    const baseDateEl = document.getElementById('baseDate');
    const daysEl = document.getElementById('days');
    const includeStartEl = document.getElementById('includeStart');

    const resultDateEl = document.getElementById('resultDate');

    const errorTextEl = document.getElementById('errorText');
    const okTextEl = document.getElementById('okText');

    const calcBtn = document.getElementById('calcBtn');
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    const resetBtn = document.getElementById('resetBtn');

    const toggleSignBtn = document.getElementById('toggleSignBtn');

    const plusBtn = document.getElementById('plusBtn');
    const minusBtn = document.getElementById('minusBtn');

    // ★追加：＋/−で1ずつ増減
    function stepDays(delta) {
      const v = String(daysEl.value ?? '').trim();

      // 空や入力途中なら「0」からスタート
      let n = 0;
      if (v !== '' && v !== '-' && v !== '+') {
        n = Number(v);
        if (Number.isNaN(n)) n = 0;
      }

      daysEl.value = String(n + delta);

      updateSignButtonState();
      calculate();
    }

    plusBtn.addEventListener('click', () => stepDays(1));
    minusBtn.addEventListener('click', () => stepDays(-1));

    function updateSignButtonState() {
      const value = daysEl.value.trim();

      if (value === '' || Number(value) === 0) {
        toggleSignBtn.disabled = true;
      } else {
        toggleSignBtn.disabled = false;
      }
    }

    toggleSignBtn.addEventListener('click', () => {
      const value = daysEl.value.trim();

      if (value === '' || Number(value) === 0) return;

      if (value.startsWith('-')) {
        daysEl.value = value.substring(1);
      } else {
        daysEl.value = '-' + value;
      }

      updateSignButtonState();
      calculate();
    });

    const WEEK = ['日', '月', '火', '水', '木', '金', '土'];

    // ✅ 今日を date input に入れる（ローカル日付）
    function setToday() {
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      baseDateEl.value = `${yyyy}-${mm}-${dd}`;
    }

    // ✅ "YYYY-MM-DD" を「その日の正午(12:00)」としてDateにする
    // （深夜0時だとタイムゾーンや夏時間でズレる事故がたまにあるので安全策）
    function parseYMDToLocalNoon(ymd) {
      const [y, m, d] = ymd.split('-').map(Number);
      return new Date(y, m - 1, d, 12, 0, 0, 0);
    }

    function formatJP(dateObj) {
      const y = dateObj.getFullYear();
      const m = dateObj.getMonth() + 1;
      const d = dateObj.getDate();
      const dayIndex = dateObj.getDay();
      const w = WEEK[dayIndex];

      // ★曜日だけクラスを付ける
      let dayClass = '';
      if (dayIndex === 0) dayClass = 'sunday';
      if (dayIndex === 6) dayClass = 'saturday';

      return `${y}/${String(m).padStart(2, '0')}/${String(d).padStart(2, '0')}（<span class="${dayClass}">${w}</span>）`;
    }

    function formatISO(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, '0');
      const d = String(dateObj.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function clearMessages() {
      errorTextEl.textContent = '';
      okTextEl.textContent = '';
    }

    function showError(msg) {
      errorTextEl.textContent = msg;
      okTextEl.textContent = '';
    }

    // ✅ 計算
    function calculate() {
      clearMessages();

      const baseYMD = baseDateEl.value;
      if (!baseYMD) {
        showError('基準日を入力してください。');
        return;
      }

      const daysStr = String(daysEl.value ?? '').trim();

      // ★変更：空ならエラーにしないで、結果を「—」に戻して終わり
      if (daysStr === '') {
        resultDateEl.textContent = '----/--/--（-）';
        updateSignButtonState();
        return;
      }

      // ★入力途中の「-」だけ等も計算しない（エラーにしない）
      if (daysStr === '-' || daysStr === '+') {
        resultDateEl.textContent = '----/--/--（-）';
        updateSignButtonState();
        return;
      }

      if (Number.isNaN(Number(daysStr))) {
        showError('日数を数値で入力してください。');
        resultDateEl.textContent = '----/--/--（-）';
        return;
      }

      const days = Number(daysStr);

      // 初日を数えるなら、実質「days-1」を足す
      let addDays;

      if (includeStartEl.checked) {
        // ★初日を数えるモード
        if (days === 1 || days === -1) {
          addDays = 0; // ★±1は当日
        } else if (days > 1) {
          addDays = days - 1;
        } else if (days < -1) {
          addDays = days + 1;
        } else {
          addDays = 0; // days === 0 の場合
        }
      } else {
        addDays = days;
      }

      const base = parseYMDToLocalNoon(baseYMD);
      const result = new Date(base);
      result.setDate(result.getDate() + addDays);

      // 曜日ごとに色を変更
      resultDateEl.innerHTML = formatJP(result);

      const baseJP = formatJP(base);
      const modeText = includeStartEl.checked ? '初日を数える' : '初日を数えない';
    }

    // リセット
    function resetAll() {
      // ★初期状態に戻す：今日 + 0
      includeStartEl.checked = false;
      setToday();       // ★今日を入れる
      daysEl.value = ''; // ★日数を0に戻す
      clearMessages();
      calculate();      // ★表示も更新
      updateSignButtonState();
    }

    // ボタン操作（★calcBtn は存在しないので if で安全に）
    if (calcBtn) calcBtn.addEventListener('click', calculate);
    resetBtn.addEventListener('click', resetAll);

    // 入力したら自動で再計算（操作がラク）
    baseDateEl.addEventListener('change', calculate);
    daysEl.addEventListener('input', () => {
      // ★追加：日数は最大4桁（-もOK）に制限する
      const MAX_DIGITS = 4;

      let raw = String(daysEl.value ?? '');

      // 先頭の - は残して、数字だけ取り出す
      const sign = raw.startsWith('-') ? '-' : '';
      let digits = raw.replace(/[^0-9]/g, ''); // 数字以外は消す

      // 先頭の0が連続するのを抑える（任意）
      digits = digits.replace(/^0+(?=\d)/, '');

      // 桁数カット
      if (digits.length > MAX_DIGITS) {
        digits = digits.slice(0, MAX_DIGITS);
      }

      // 反映
      daysEl.value = sign + digits;

      updateSignButtonState();

      const v = String(daysEl.value).trim();

      // ★追加：空 or 入力途中なら「結果をリセット表示」に戻す
      if (v === '' || v === '-' || v === '+') {
        clearMessages(); // エラー文も消す（任意だけど見た目が綺麗）
        resultDateEl.textContent = '----/--/--（-）';
        return;
      }

      calculate();
    });
    includeStartEl.addEventListener('change', calculate);

    // 初期状態：今日を入れておく（好みで消してOK）
    setToday();
    daysEl.value = '';          // ★初期は空
    resultDateEl.textContent = '----/--/--（-）';
    updateSignButtonState();
    calculate(); // ←このままでOK（空なら—で終わる）
  </script>
</body>

</html>
